<!doctype html>
<html lang="he" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>תרגול</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Rubik:wght@400;600;800&family=Heebo:wght@400;600;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <main class="container">
    <a href="index.html" class="btn">← בית</a>
    <label class="btn" style="margin-inline-start:12px">
      <input id="mode" type="checkbox" hidden />
      מצב בחינה (כבוי/דלוק)
    </label>
    <h1 id="title">תרגול</h1>

    <section class="card" id="exercise" aria-labelledby="ex-title">
      <h3 id="ex-title"></h3>
      <p id="passage"></p>
      <div class="progress-ring" id="ring" aria-label="התקדמות">
        <svg width="44" height="44">
          <circle cx="22" cy="22" r="18" stroke="rgba(255,255,255,.08)" stroke-width="6" fill="none"></circle>
          <circle id="ringVal" cx="22" cy="22" r="18" stroke="var(--accent)" stroke-width="6" fill="none" stroke-linecap="round" stroke-dasharray="113" stroke-dashoffset="113"></circle>
        </svg>
        <div class="label" id="ringLabel">0%</div>
      </div>

      <div id="qwrap"></div>
    </section>
  </main>

  <script type="module">
    import {getParam, loadExercise, setupMCQ, setupCloze, setupRing} from './js/app.js';
    const id = getParam('id');
    const data = await loadExercise(id);
    document.getElementById('title').textContent = data.title || 'תרגול';
    document.getElementById('ex-title').textContent = `${data.category} — ${data.topic} (Unit ${data.unit})`;
    document.getElementById('passage').innerHTML = data.content.passage || '';
    const {setProgress} = setupRing();
    const qwrap = document.getElementById('qwrap');
    let progress = 0, total = data.content.questions.length;
    data.content.questions.forEach((q,i)=>{
      if(q.qtype==='MCQ'){
        const el = setupMCQ(q, (ok)=>{ progress = Math.max(0, Math.min(total, progress + (ok?1:0))); setProgress(progress/total); });
        qwrap.appendChild(el);
      } else if(q.qtype==='Cloze'){
        const el = setupCloze(q, (ok)=>{ progress = Math.max(0, Math.min(total, progress + (ok?1:0))); setProgress(progress/total); });
        qwrap.appendChild(el);
      }
    });
    const mode = document.getElementById('mode');
    mode.addEventListener('change', ()=> document.body.toggleAttribute('data-exam', mode.checked));
  </script>
</body>
</html>
